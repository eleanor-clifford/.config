# Personal config files

### Warning!

I use my own keyboard layout (based on colemak) so there are many mappings in
here which don't make sense for most people.

### Organisation

The strategy here is to keep everything in `$HOME/.config` and symlink when
necessary into `$HOME`. That way everything is easily contained in one folder.
See also my [vim](https://github.com/tim-clifford/vimrc) and
[firefox](https://github.com/tim-clifford/minimal-functional-firefox-dracula)
configs which will be automatically installed by `install.sh`. Anything
automatically put in my `$HOME/.config` by packages which I haven't configured
will be in the gitignore for conciseness of this repo.

### Metaconfiguration

I use two machines with similar but slightly different configuration
requirements, which has always made it annoying to switch between them after a
cycle of tweaking the other one. Therefore this repo follows a strategy of
*metaconfiguration*, where the differences between the files are mostly stored
in `.metaconf` files in `./metaconfig`. These contain common identifiers and
their host-specific replacements. For example, each machine has a different
display DPI, so this is stored in the `.metaconf` files, and the matching
identifier in `.Xresources` is automatically replaced by `install.sh`. For
flexibility there are also APPEND files, which are host-specific lines of
configuration that are appended to the original files by `install.sh`.

### Installing

`install.sh` follows the following basic procedure:

1. Check that there are no unstaged changes, and that there are no illegal
   commits (i.e. a commit generated by `install.sh` which was not reverted,
   see point 10)
2. Look for a metaconfig file matching this hostname, continue only if it
   exists
3. Apply rules in the metaconfig file and append files to all files in the
   repo.
4. Symlink any file starting in . into $HOME. This can be skipped with
   `--no-link`
5. Clone [my vim config](https://github.com/tim-clifford/vimrc) into
   $HOME/.vim/git, (or pull if it exists). This can be skipped with
   `--vimrc-none`
6. Run vimrc install script to install plugins etc. This can be replaced with
   a pluginless config with `--vimrc-minimal`.
7. Install [my firefox
   config](https://github.com/tim-clifford/minimal-functional-firefox-dracula).
   This can be skipped with `--no-firefox`
8. Install less keybindings
9. Prompt to change shell to fish. This can be skipped with `--no-fish`.
10. Commit changes to this directory and add git push hook to prevent it being
   pushed. This is so that it's easy to see what changes have been made since
   the metaconfiguration was applied, as the output of `git diff HEAD` will
   have been polluted. The intended workflow is to then stash those changes,
   revert to a generic state, apply the changes, commit, push, and regerate
   the host-specific configuration. This ensures that configuration-divergence
   is mitigated.
